var RECENT_ACTIVITY_TIME_INTERVAL_MIN=15;var MAP_REFRESH_RATE=2000;var map=null;var RideLocation=null;var lastSavedLocation=null;var positionMarker=null;$(document).ready(function(){initHeader();initClassList()});function initHeader(){console.log("DEBUG: initializing header section");var a=moment();var f=document.querySelector(".header-title");if(between(1,12)){f.innerHTML="Good morning, Sofia"}else{if(between(12,18)){f.innerHTML="Good afternoon, Sofia"}else{f.innerHTML="Good night, Sofia"}}var g=document.querySelector(".header-date");g.innerHTML=a.format("dddd")+", "+a.format("D MMM");if(store.enabled){console.log("DEBUG: localstore enabled");var h=store.get("lastWeatherFetch");if(h){console.log("DEBUG: has fetched weather info before");h=moment(h);if(moment().diff(h,"seconds")<(30*60)){console.log("DEBUG: less than 30 minutes ago, using cached data");var i=store.get("weatherTemp");var d=store.get("weather");var c=store.get("weatherDescription");var b=store.get("weatherIcon");var e=document.querySelector(".header-weather-description");e.innerHTML=""+i+"ºc, "+d;var j=$(".weather-icon");j.addClass(b);return}}else{console.log("DEBUG: no weather info available")}}else{console.log("DEBUG: localstore disabled")}console.log("DEBUG: performing WeatherAPI request");$.get("/weather",function(n){console.log("DEBUG: finished request");var p=document.querySelector(".header-weather-description");if(n){console.log("DEBUG: received valid weather data");n=JSON.parse(n);var k=$(".weather-icon");var l=n.main.temp-273.15;var q=n.weather[0].main;var m=n.weather[0].description;if(store.enabled){console.log("DEBUG: saving weather info to localstore");store.set("weatherTemp",l);store.set("weather",q);store.set("weatherDescription",m);store.set("lastWeatherFetch",moment())}console.log("DEBUG: finding correct weather icon");p.innerHTML=""+l+"ºc, "+q;var o=between(7,18);switch(q){case"Clear":if(o){k.addClass("sunny-day");store.set("weatherIcon","sunny-day")}else{k.addClass("clear-night");store.set("weatherIcon","clear-night")}break;case"Clouds":if(o){if(m==="few clouds"){k.addClass("sun-cloudy-day");store.set("weatherIcon","sun-cloudy-day")}else{k.addClass("cloudy-day");store.set("weatherIcon","cloudy-day")}}else{k.addClass("cloudy-night");store.set("weatherIcon","cloudy-night")}break;case"Rain":k.addClass("rainy-day");store.set("weatherIcon","rainy-day");break;case"Thunderstorm":k.addClass("thunderstorm");store.set("weatherIcon","thunderstorm");break;case"Extreme":if(m==="windy"){k.addClass("windy-day");store.set("weatherIcon","windy-day")}break;default:}}else{p.innerHTML="No weather info available..."}})}function initClassList(){console.log("DEBUG: initializing class list section");var a=moment();switch(a.day()){case 6:case 0:addWeekendClasses();break;case 1:addMondayClasses();break;case 2:addTuesdayClasses();break;case 3:addWednesdayClasses();break;case 4:addThursdayClasses();break;case 5:addFridayClasses();break;default:}}function addClasses(c){var b=$.templates('<li class="list-group-item row-container"><div class="sidebar"><div class="sidebar-timer"><span class="glyphicon glyphicon-time {{:timerIconHiddenClass}}" aria-hidden="true"></span><span>{{:timeLeft}}</span></div></div><div class="content row-container"><div class="class-info {{:classActiveClass}}"><p class="class-info-primary">{{:className}}</p><p>{{:tomorrowWarning}}</p><p>{{:classStarts}} - {{:classEnds}}</p><p>{{:classLocation}}</p></div><div class="class-state"><span>{{:classType}}</span></div></div></li>');for(var a=0;a<c.length;a++){$(".list-class-items").append(b.render(c[a]))}}function addMondayClasses(){var a=[];if(between(0,9)){a.push({className:"Biologia Celular",classStarts:"09:00",classEnds:"11:00",classLocation:"E1, P1, Sala E102",classType:"P",timerIconHiddenClass:"hidden"})}else{if(between(9,11)){a.push({className:"Biologia Celular",classStarts:"09:00",classEnds:"11:00",classLocation:"E1, P1, Sala E102",classType:"P",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Métodos Quantitativos",classStarts:"11:00",classEnds:"13:00",classLocation:"EA, P0, Sala EA02",classType:"T",timerIconHiddenClass:"hidden"})}else{if(between(11,13)){a.push({className:"Métodos Quantitativos",classStarts:"11:00",classEnds:"13:00",classLocation:"EA, P0, Sala EA02",classType:"T",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Métodos Quantitativos",classStarts:"14:00",classEnds:"17:00",classLocation:"E3, P1, Sala E311",classType:"P",timerIconHiddenClass:"hidden"})}else{if(between(13,14)){a.push({className:"Métodos Quantitativos",classStarts:"14:00",classEnds:"17:00",classLocation:"E3, P1, Sala E311",classType:"P",timerIconHiddenClass:"hidden"})}else{if(between(14,17)){a.push({className:"Métodos Quantitativos",classStarts:"14:00",classEnds:"17:00",classLocation:"E3, P1, Sala E311",classType:"P",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Quimíca Biológica",classStarts:"08:30",classEnds:"10:30",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden",tomorrowWarning:"Tomorrow, Tuesday"})}else{a.push({className:"Quimíca Biológica",classStarts:"08:30",classEnds:"10:30",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden",tomorrowWarning:"Tomorrow, Tuesday"})}}}}}addClasses(a)}function addTuesdayClasses(){var a=[];if(between(0,0,8,30)){a.push({className:"Química Biológica",classStarts:"08:30",classEnds:"10:30",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden"})}else{if(between(8,30,10,30)){a.push({className:"Química Biológica",classStarts:"08:30",classEnds:"10:30",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"BioFísica",classStarts:"10:30",classEnds:"12:00",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden"})}else{if(between(10,30,12,0)){a.push({className:"BioFísica",classStarts:"10:30",classEnds:"12:00",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Sociologia Médica",classStarts:"12:00",classEnds:"13:00",classLocation:"EA, P0, Auditório 06",classType:"TP",timerIconHiddenClass:"hidden"})}else{if(between(12,13)){a.push({className:"Sociologia Médica",classStarts:"12:00",classEnds:"13:00",classLocation:"EA, P0, Auditório 06",classType:"TP",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Biologia Celular",classStarts:"11:00",classEnds:"13:00",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden",tomorrowWarning:"Tomorrow, Wednesday"})}else{a.push({className:"Biologia Celular",classStarts:"11:00",classEnds:"13:00",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden",tomorrowWarning:"Tomorrow, Wednesday"})}}}}addClasses(a)}function addWednesdayClasses(){var a=[];if(between(0,11)){a.push({className:"Biologia Celular",classStarts:"11:00",classEnds:"13:00",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden"})}else{if(between(11,13)){a.push({className:"Biologia Celular",classStarts:"11:00",classEnds:"13:00",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Genética Básica",classStarts:"14:00",classEnds:"16:00",classLocation:"E3, P1, E305",classType:"P",timerIconHiddenClass:"hidden"})}else{if(between(13,14)){a.push({className:"Genética Básica",classStarts:"14:00",classEnds:"16:00",classLocation:"E3, P1, E305",classType:"P",timerIconHiddenClass:"hidden"})}else{if(between(14,16)){a.push({className:"Genética Básica",classStarts:"14:00",classEnds:"16:00",classLocation:"E3, P1, E305",classType:"P",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Química Biológica I",classStarts:"16:00",classEnds:"18:00",classLocation:"E3, P1, Sala 12",classType:"P",timerIconHiddenClass:"hidden"})}else{if(between(16,18)){a.push({className:"Química Biológica I",classStarts:"16:00",classEnds:"18:00",classLocation:"E3, P1, Sala 12",classType:"P",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Anatomia Sistemática",classStarts:"09:00",classEnds:"11:00",classLocation:"E1, P3, E01",classType:"P",timerIconHiddenClass:"hidden",tomorrowWarning:"Tomorrow, Wednesday"})}else{a.push({className:"Anatomia Sistemática",classStarts:"09:00",classEnds:"11:00",classLocation:"E1, P3, E01",classType:"P",timerIconHiddenClass:"hidden",tomorrowWarning:"Tomorrow, Wednesday"})}}}}}addClasses(a)}function addThursdayClasses(){var a=[];if(between(0,9)){a.push({className:"Anatomia Sistemática",classStarts:"09:00",classEnds:"11:00",classLocation:"E1, P3, E01",classType:"P",timerIconHiddenClass:"hidden"})}else{if(between(9,11)){a.push({className:"Anatomia Sistemática",classStarts:"09:00",classEnds:"11:00",classLocation:"E1, P3, E01",classType:"P",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Anatomia Sistemática",classStarts:"11:00",classEnds:"12:00",classLocation:"EA, P0, Auditório 02",classType:"T",timerIconHiddenClass:"hidden"})}else{if(between(11,12)){a.push({className:"Anatomia Sistemática",classStarts:"11:00",classEnds:"12:00",classLocation:"EA, P0, Auditório 02",classType:"T",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Fisiologia",classStarts:"12:00",classEnds:"13:00",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden"})}else{if(between(12,13)){a.push({className:"Fisiologia",classStarts:"12:00",classEnds:"13:00",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden",classActiveClass:"class-active"})}}}}addClasses(a)}function addFridayClasses(){var a=[];if(between(0,8)){a.push({className:"Química Biológica I",classStarts:"08:00",classEnds:"09:00",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden"})}else{if(between(8,9)){a.push({className:"Química Biológica I",classStarts:"08:00",classEnds:"09:00",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Métodos Quantitativos",classStarts:"09:00",classEnds:"10:00",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden"})}else{if(between(9,10)){a.push({className:"Métodos Quantitativos",classStarts:"09:00",classEnds:"10:00",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Genética Básica",classStarts:"10:00",classEnds:"11:00",classLocation:"EA, P0, Auditório 01",classType:"T",timerIconHiddenClass:"hidden"})}else{if(between(10,11)){a.push({className:"Genética Básica",classStarts:"10:00",classEnds:"11:00",classLocation:"EA, P0, Auditório 01",classType:"T",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"BioFísica",classStarts:"12:00",classEnds:"13:00",classLocation:"EA, P0, Auditório 01",classType:"P",timerIconHiddenClass:"hidden"})}else{if(between(11,12)){a.push({className:"BioFísica",classStarts:"12:00",classEnds:"13:00",classLocation:"EA, P0, Auditório 01",classType:"P",timerIconHiddenClass:"hidden"})}else{if(between(12,13)){a.push({className:"BioFísica",classStarts:"12:00",classEnds:"13:00",classLocation:"EA, P0, Auditório 01",classType:"P",timerIconHiddenClass:"hidden",classActiveClass:"class-active"})}else{a.push({className:"Encontro com o Miguel",classStarts:"15:00",classEnds:"03:00",classLocation:"Muitos sítios",classType:"P",timerIconHiddenClass:"hidden"})}}}}}}addClasses(a)}function addWeekendClasses(){var a=[];a.push({className:"Biologia Celular",classStarts:"09:00",classEnds:"11:00",classLocation:"E1, P1, Sala E102",classType:"P",timerIconHiddenClass:"hidden"});addClasses(a)}function initMap(){Parse.initialize("Ryl6jYhQ3iK0sJuYDwQLgIzyxbMfWQZXifnj2VzPYoGETPafPeg7iCN47rcwPXIY","unused");Parse.serverURL="https://m3parseserver.herokuapp.com/parse";RideLocation=Parse.Object.extend("ride_location");var a=new Parse.Query(RideLocation);a.descending("timestamp");a.first({success:function(e){if(e){console.log("DEBUG: fetched last location event");var c=moment(e.get("timestamp"));var d=moment();var b=d.diff(c,"seconds");if(b<(RECENT_ACTIVITY_TIME_INTERVAL_MIN*60)){$(".trip-warning").addClass("hidden");$(".trip-stats").removeClass("hidden");map=new google.maps.Map(document.getElementById("map"),{center:{lat:41.14852999340849,lng:-8.606939837344555},scrollwheel:true,zoom:16,mapTypeControl:false,});watchActivity();return}else{console.log("DEBUG: no active ride available")}}else{console.log("DEBUG: no active ride available")}$(".trip-warning").removeClass("hidden")},error:function(b){console.log("ERROR: fetching last location "+b.code+" ["+b.message+"]")}})}function watchActivity(){console.log("DEBUG: watching recent activity");var a=new Parse.Query(RideLocation);a.descending("timestamp");a.first({success:function(c){if(c){if(lastSavedLocation&&(lastSavedLocation.get("latitude")==c.get("latitude")&&lastSavedLocation.get("longitude")==c.get("longitude"))){console.log("DEBUG: no movement since last event");setTimeout(watchActivity,2000);return}if(positionMarker){positionMarker.setMap(null);positionMarker=null}var d=new google.maps.LatLng(c.get("latitude"),c.get("longitude"));positionMarker=new google.maps.Marker({position:d,map:map});map.setCenter(d);var e=parseInt(c.get("speed"));if(e){var b=$("#trip-speed");if(e>=0){e=(e*3600)/1000;b.html(""+e+" Km/h")}else{b.html("0 Km/h")}}lastSavedLocation=c;setTimeout(watchActivity,2000)}},error:function(b){console.log("ERROR: fetching last location "+b.code+" ["+b.message+"]");setTimeout(watchActivity,2000)}})}function between(c,a){var b=moment();console.log(arguments.length);if(arguments.length==2){return b.isSameOrAfter(b.clone().hour(c).minute(0).second(0))&&b.isSameOrBefore(b.clone().hour(a).minute(0).second(0))}else{if(arguments.length==4){return b.isSameOrAfter(b.clone().hour(arguments[0]).minute(arguments[1]).second(0))&&b.isSameOrBefore(b.clone().hour(arguments[2]).minute(arguments[3]).second(0))}}};