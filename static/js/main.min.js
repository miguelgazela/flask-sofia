var RECENT_ACTIVITY_TIME_INTERVAL=5;var MAP_REFRESH_RATE=2000;var map=null;var RideLocation=null;var lastSavedLocation=null;var positionMarker=null;$(document).ready(function(){initHeader();initClassList()});function initHeader(){var a=moment();var f=document.querySelector(".header-title");if(between(1,12)){f.innerHTML="Good morning, Sofia"}else{if(between(12,18)){f.innerHTML="Good afternoon, Sofia"}else{f.innerHTML="Good night, Sofia"}}var g=document.querySelector(".header-date");g.innerHTML=a.format("dddd")+", "+a.format("D MMM");if(store.enabled){console.log("DEBUG: Store is enabled");var h=store.get("lastWeatherFetch");if(h){h=moment(h);if(moment().diff(h,"seconds")<(30*60)){console.log("DEBUG: Less than 30 minutes ago");var i=store.get("weatherTemp");var d=store.get("weather");var c=store.get("weatherDescription");var b=store.get("weatherIcon");var e=document.querySelector(".header-weather-description");e.innerHTML=""+i+"ºc, "+d;var j=$(".weather-icon");j.addClass(b);return}}else{console.log("DEBUG: No weather has been fetched")}}else{console.log("DEBUG: Store is disabled")}console.log("DEBUG: Making WeatherAPI request");$.get("/weather",function(n){console.log("DEBUG: Fetched weather info");var p=document.querySelector(".header-weather-description");if(n){n=JSON.parse(n);var k=$(".weather-icon");var l=n.main.temp-273.15;var q=n.weather[0].main;var m=n.weather[0].description;if(store.enabled){store.set("weatherTemp",l);store.set("weather",q);store.set("weatherDescription",m);store.set("lastWeatherFetch",moment())}p.innerHTML=""+l+"ºc, "+q;var o=between(7,18);switch(q){case"Clear":if(o){k.addClass("sunny-day");store.set("weatherIcon","sunny-day")}else{k.addClass("clear-night");store.set("weatherIcon","clear-night")}break;case"Clouds":if(o){if(m==="few clouds"){k.addClass("sun-cloudy-day");store.set("weatherIcon","sun-cloudy-day")}else{k.addClass("cloudy-day");store.set("weatherIcon","cloudy-day")}}else{k.addClass("cloudy-night");store.set("weatherIcon","cloudy-night")}break;case"Rain":k.addClass("rainy-day");store.set("weatherIcon","rainy-day");break;case"Thunderstorm":k.addClass("thunderstorm");store.set("weatherIcon","thunderstorm");break;case"Extreme":if(m==="windy"){k.addClass("windy-day");store.set("weatherIcon","windy-day")}break;default:}}else{p.innerHTML="Não consegui ver o tempo..."}})}function initClassList(){var a=moment();switch(a.day()){case 6:case 0:break;case 1:addMondayClasses();break;case 2:break;case 3:break;case 4:break;case 5:break;default:}}function addClasses(c){var b=$.templates('<li class="list-group-item row-container"><div class="sidebar"><div class="sidebar-timer"><span class="glyphicon glyphicon-time {{:timerIconHiddenClass}}" aria-hidden="true"></span><span>{{:timeLeft}}</span></div></div><div class="content row-container"><div class="class-info {{:classActiveClass}}"><p class="class-info-primary">{{:className}}</p><p>{{:tomorrowWarning}}</p><p>{{:classStarts}} - {{:classEnds}}</p><p>{{:classLocation}}</p></div><div class="class-state"><span>{{:classType}}</span></div></div></li>');for(var a=0;a<c.length;a++){$(".list-class-items").append(b.render(c[a]))}}function addMondayClasses(){var a=[];if(between(0,9)){a.push({className:"Biologia Celular",classStarts:"09:00",classEnds:"11:00",classLocation:"E1, P1, Sala E102",classType:"P",timerIconHiddenClass:"hidden"})}else{if(between(9,11)){a.push({className:"Biologia Celular",classStarts:"09:00",classEnds:"11:00",classLocation:"E1, P1, Sala E102",classType:"P",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Métodos Quantitativos",classStarts:"11:00",classEnds:"13:00",classLocation:"EA, P0, Sala EA02",classType:"T",timerIconHiddenClass:"hidden"})}else{if(between(11,13)){a.push({className:"Métodos Quantitativos",classStarts:"11:00",classEnds:"13:00",classLocation:"EA, P0, Sala EA02",classType:"T",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Métodos Quantitativos",classStarts:"14:00",classEnds:"17:00",classLocation:"E3, P1, Sala E311",classType:"P",timerIconHiddenClass:"hidden"})}else{if(between(13,14)){a.push({className:"Métodos Quantitativos",classStarts:"14:00",classEnds:"17:00",classLocation:"E3, P1, Sala E311",classType:"P",timerIconHiddenClass:"hidden"})}else{if(between(14,17)){a.push({className:"Métodos Quantitativos",classStarts:"14:00",classEnds:"17:00",classLocation:"E3, P1, Sala E311",classType:"P",timerIconHiddenClass:"hidden",classActiveClass:"class-active"});a.push({className:"Quimíca Biológica",classStarts:"08:30",classEnds:"10:30",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden",tomorrowWarning:"Tomorrow, Tuesday"})}else{a.push({className:"Quimíca Biológica",classStarts:"08:30",classEnds:"10:30",classLocation:"EA, P0, Auditório 06",classType:"T",timerIconHiddenClass:"hidden",tomorrowWarning:"Tomorrow, Tuesday"})}}}}}addClasses(a)}function addTuesdayClasses(){}function addWednesdayClasses(){}function addThursdayClasses(){}function addFridayClasses(){}function addWeekendClasses(){}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:41.14852999340849,lng:-8.606939837344555},scrollwheel:true,zoom:16,mapTypeControl:false,});Parse.initialize("Ryl6jYhQ3iK0sJuYDwQLgIzyxbMfWQZXifnj2VzPYoGETPafPeg7iCN47rcwPXIY","unused");Parse.serverURL="https://m3parseserver.herokuapp.com/parse";RideLocation=Parse.Object.extend("ride_location");var a=new Parse.Query(RideLocation);a.descending("timestamp");a.first({success:function(e){if(e){console.log("Last saved location:");console.log(e);var c=moment(e.get("timestamp"));var d=moment();var b=d.diff(c,"seconds");if(b<(RECENT_ACTIVITY_TIME_INTERVAL*60)){startMonitoringActivity()}else{console.log("No recent activity to display...")}}},error:function(b){console.log("Error getting last location: "+b.code+" "+b.message)}})}function startMonitoringActivity(){console.log("Start monitoring activity...");var a=new Parse.Query(RideLocation);a.descending("timestamp");a.first({success:function(b){if(b){console.log(b);if(lastSavedLocation&&(lastSavedLocation.get("latitude")==b.get("latitude")&&lastSavedLocation.get("longitude")==b.get("longitude"))){console.log("Same location as before...");setTimeout(startMonitoringActivity,2000);return}if(positionMarker){console.log("Clearing map from previous position marker...");positionMarker.setMap(null);positionMarker=null}var c=new google.maps.LatLng(b.get("latitude"),b.get("longitude"));positionMarker=new google.maps.Marker({position:c,map:map});map.setCenter(c);lastSavedLocation=b;setTimeout(startMonitoringActivity,2000)}},error:function(b){console.log("Error getting last location: "+b.code+" "+b.message)}})}function between(c,a){var b=moment();return b.isSameOrAfter(b.clone().hour(c).minute(0).second(0))&&b.isSameOrBefore(b.clone().hour(a).minute(0).second(0))};